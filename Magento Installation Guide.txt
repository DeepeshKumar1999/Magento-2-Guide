Step 1: Setup the server
------------------------------------------------------------------------------------------------------------
1) Install the Apache web server by running:
sudo apt install apache2 -y

2) Enable Apache to start automatically on system boot:
sudo systemctl enable apache2.service

3) Create a virtual host file for Magento named magento2.conf with the nano editor:
sudo nano /etc/apache2/sites-available/magento2.conf

4) Copy and paste the following lines into the file, replacing yourdomain.com with your actual domain name:
<VirtualHost *:80>
ServerAdmin webmaster@localhost
DocumentRoot /var/www/html
ErrorLog ${APACHE_LOG_DIR}/error.log
CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
<VirtualHost *:80>
    ServerName yourdomain.com
    DocumentRoot /var/www/html/magento2/pub
</VirtualHost>

5) Save your changes and exit nano by pressing Ctrl + X â†’ Y â†’ Enter.

6) Activate the new site configuration for the web server group:
sudo a2ensite magento2.conf
sudo systemctl restart apache2.service

7) Enable necessary Apache modules for Magento to function properly:
sudo a2enmod rewrite
sudo a2enmod headers
sudo systemctl restart apache2.service


8) Change Apache default DocumentRoot directory.
a) Make new path directory.
mkdir -p /home/current-user/www/html
echo "It works!" > /home/current-user/www/html/index.html

b) Update below files directory path "/var/www/html" with updated path "/home/current-user/www/html"
/etc/apache2/sites-available/000-default.conf
/etc/apache2/apache2.conf

c) execute below commands
sudo usermod -aG current-user www-data
sudo chmod -R 775 /home/current-user/www
sudo systemctl restart apache2

d) Add new sites.
<VirtualHost *:80>
    ServerName mywebsite.org
    ServerAlias www.mywebsite.org
    DocumentRoot /home/current-user/www/websites/mywebsite.org
    <Directory /home/current-user/www/websites/>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    ErrorLog ${APACHE_LOG_DIR}/mywebsite-error.log
    CustomLog ${APACHE_LOG_DIR}/mywebsite-access.log combined
</VirtualHost>

sudo a2ensite blog.mywebsite.org.conf
sudo systemctl reload apache2


e) Fix File Permission Related Issue
Step 1ï¸âƒ£ â€” Ensure correct ownership
cd /home/current-user/www/html/
sudo chown -R current-user:www-data magento/

Step 2ï¸âƒ£ â€” Set correct permissions to required dirs
sudo chmod -R g+ws magento/

Step 3ï¸âƒ£ â€” Allow Apache to create files that CLI can access
sudo usermod -a -G www-data current-user
ðŸ”¥ Important: Logout & login again after this command
â†’ So group membership refreshes

f) Fix upload file size related issue.
Create or edit: /your-project/.htaccess
php_value upload_max_filesize 100M
php_value post_max_size 100M




Step 2: Setup Database
------------------------------------------------------------------------------------------------------------
1) Install MySql Server
sudo apt install mysql-server

2) Check and verify MySql server
mysql -V

3) Secure MySQL installation
sudo mysql_secure_installation
a) Validate password strength to prevent users from using weak credentials.
b) Disallow root login remotely, allowing database access only from localhost.
c) Delete anonymous user accounts, which enable all users to log in to your database. 
d) Remove the default test database that is accessible to all users.

4) Verify MySQL functionality
sudo systemctl status mysql
sudo systemctl start mysql

5) Set password is not already set
sudo mysql -u root
ALTER USER 'root'@'localhost' IDENTIFIED BY 'mysql_password';
FLUSH PRIVILEGES;
EXIT;

sudo mysql
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'mysql_password';
FLUSH PRIVILEGES;



Step 3: Install PHP and Extensions
------------------------------------------------------------------------------------------------------------
sudo apt update
sudo apt install software-properties-common -y
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update
sudo apt install php8.3 libapache2-mod-php8.3 php8.3-common php8.3-gmp php8.3-curl php8.3-soap php8.3-bcmath php8.3-intl php8.3-mbstring php8.3-xmlrpc php8.3-mysql php8.3-gd php8.3-xml php8.3-cli php8.3-zip -y
sudo a2enmod php8.3
sudo systemctl restart apache2

php -d memory_limit=-1 bin/magento

sudo a2enmod rewrite
sudo systemctl restart apache2




Step 3: Install OpenSearch
------------------------------------------------------------------------------------------------------------
1) Import the OpenSearch GPG key
wget -qO - https://artifacts.opensearch.org/publickeys/opensearch.pgp | sudo gpg --dearmor -o /usr/share/keyrings/opensearch-keyring.gpg

2) Add the OpenSearch repository
echo "deb [signed-by=/usr/share/keyrings/opensearch-keyring.gpg] https://artifacts.opensearch.org/releases/bundle/opensearch/2.x/apt stable main" | sudo tee /etc/apt/sources.list.d/opensearch.list

3) Update package index
sudo apt update

4) Install OpenSearch
sudo apt install opensearch -y

5) Configure OpenSearch
sudo nano /etc/opensearch/opensearch.yml

cluster.name: my-cluster
node.name: node-1
network.host: 0.0.0.0   # allows access from other machines (or use 127.0.0.1 for localhost)
http.port: 9200

6) Install OpenJDK 17
sudo apt update
sudo apt install openjdk-17-jdk -y
java -version

7) Set JAVA_HOME (optional but recommended)
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
echo 'export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64' >> ~/.bashrc

8) Fix permissions (if needed)
sudo chown -R opensearch:opensearch /usr/share/opensearch
sudo chown -R opensearch:opensearch /var/lib/opensearch
sudo chown -R opensearch:opensearch /etc/opensearch

sudo dpkg --configure -a

env OPENSEARCH_INITIAL_ADMIN_PASSWORD=opensearch@secure apt install opensearch

sudo nano /etc/opensearch/opensearch.yml
sudo systemctl daemon-reload
sudo systemctl restart opensearch
sudo systemctl status opensearch
curl http://localhost:9200

9) Enable and start OpenSearch
sudo systemctl enable opensearch
sudo systemctl start opensearch
sudo systemctl status opensearch

10) Test the installation
curl -X GET "localhost:9200/"





Step 4: Install Composer
------------------------------------------------------------------------------------------------------------
1) Download and install Composer globally
cd ~
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php -r "if (hash_file('SHA384', 'composer-setup.php') === file_get_contents('https://composer.github.io/installer.sig')) { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
sudo php composer-setup.php --install-dir=/usr/local/bin --filename=composer
php -r "unlink('composer-setup.php');"

2) Check Composer version:
composer --version



Step 5: Install Magento
------------------------------------------------------------------------------------------------------------
1) Create Magento Project
composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition=2.4.8-p3 magento

2) Install Magento
php bin/magento setup:install --base-url=http://127.0.0.1/magento/pub --db-host=localhost --db-name=database_name --db-user=_database_root --db-password=database_password --admin-firstname=Admin --admin-lastname=User --admin-email=adminemail@gmail.com --admin-user=admin --admin-password=admin123 --language=en_US --currency=USD --timezone=America/Chicago --use-rewrites=1 --search-engine=opensearch --opensearch-host=localhost --opensearch-port=9200 --opensearch-index-prefix=opensearch_index_prefix --opensearch-timeout=15 --backend-frontname=admin

3) Disable Two Factor Authentication
php bin/magento module:disable Magento_TwoFactorAuth Magento_AdminAdobeImsTwoFactorAuth

4) Set the deployment mode to developer
php bin/magento deploy:mode:set developer

5) Install Sample Data:
php bin/magento deploy:mode:set developer
rm -rf generated/code/* generated/metadata/*
php bin/magento sampledata:deploy
php bin/magento setup:upgrade
php bin/magento cache:clean
php bin/magento cache:flush

Magento Public Key: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Magento Private Key: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

php bin/magento setup:perf:generate-fixtures setup/performance-toolkit/profiles/ee/small.xml
rm -rf generated/code/* var/cache/* var/page_cache/*

php -d memory_limit=-1 bin/magento
