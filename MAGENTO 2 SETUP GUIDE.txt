MAGENTO 2 SETUP GUIDE (APACHE + MYSQL + PHP + OPENSEARCH)
=========================================================

STEP 1: SERVER & APACHE SETUP
-----------------------------

1. Install Apache
sudo apt update
sudo apt install apache2 -y
sudo systemctl enable apache2
sudo systemctl start apache2

2. Enable Required Apache Modules
sudo a2enmod rewrite headers
sudo systemctl restart apache2

3. Create Magento VirtualHost
sudo nano /etc/apache2/sites-available/magento2.conf

<VirtualHost *:80>
    ServerName yourdomain.com
    DocumentRoot /var/www/html/magento/pub

    <Directory /var/www/html/magento/pub>
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/magento-error.log
    CustomLog ${APACHE_LOG_DIR}/magento-access.log combined
</VirtualHost>

4. Enable Site
sudo a2ensite magento2.conf
sudo a2dissite 000-default.conf
sudo systemctl reload apache2

---------------------------------------------------------

STEP 2: DATABASE SETUP (MYSQL)
------------------------------

1. Install MySQL
sudo apt install mysql-server -y

2. Secure MySQL
sudo mysql_secure_installation

3. Configure Root Password
sudo mysql
ALTER USER 'root'@'localhost'
IDENTIFIED WITH mysql_native_password BY 'StrongPassword@123';
FLUSH PRIVILEGES;
EXIT;

---------------------------------------------------------

STEP 3: PHP 8.3 & EXTENSIONS
----------------------------

sudo add-apt-repository ppa:ondrej/php -y
sudo apt update

sudo apt install php8.3 libapache2-mod-php8.3 \
php8.3-cli php8.3-common php8.3-curl php8.3-gd \
php8.3-intl php8.3-mbstring php8.3-mysql \
php8.3-soap php8.3-bcmath php8.3-xml \
php8.3-zip php8.3-opcache php8.3-xsl -y

sudo systemctl restart apache2

---------------------------------------------------------

STEP 4: OPENSEARCH INSTALLATION
-------------------------------

1. Install OpenJDK 17
sudo apt install openjdk-17-jdk -y

2. Install OpenSearch
sudo apt install opensearch -y

3. Configure OpenSearch
sudo nano /etc/opensearch/opensearch.yml

cluster.name: magento-cluster
node.name: node-1
network.host: 127.0.0.1
http.port: 9200
discovery.type: single-node

4. Start Service
sudo systemctl enable opensearch
sudo systemctl start opensearch

Test:
curl http://localhost:9200

---------------------------------------------------------

STEP 5: COMPOSER INSTALLATION
-----------------------------

php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
sudo php composer-setup.php --install-dir=/usr/local/bin --filename=composer
php -r "unlink('composer-setup.php');"

composer --version

---------------------------------------------------------

STEP 6: MAGENTO INSTALLATION
----------------------------

1. Create Project
composer create-project \
--repository-url=https://repo.magento.com/ \
magento/project-community-edition=2.4.8-p3 magento

2. Permissions
sudo chown -R $USER:www-data magento
find magento -type f -exec chmod 664 {} \;
find magento -type d -exec chmod 775 {} \;

3. Install Magento
php bin/magento setup:install \
--base-url=http://yourdomain.com \
--db-host=localhost \
--db-name=magento \
--db-user=root \
--db-password=StrongPassword@123 \
--admin-firstname=Admin \
--admin-lastname=User \
--admin-email=admin@example.com \
--admin-user=admin \
--admin-password=admin@123 \
--language=en_US \
--currency=INR \
--timezone=Asia/Kolkata \
--use-rewrites=1 \
--search-engine=opensearch \
--opensearch-host=localhost \
--opensearch-port=9200 \
--backend-frontname=admin

4. Developer Mode
php bin/magento deploy:mode:set developer

5. Disable 2FA (DEV ONLY)
php bin/magento module:disable Magento_TwoFactorAuth
php bin/magento setup:upgrade

---------------------------------------------------------

FINAL NOTES
-----------
- Never expose OpenSearch publicly
- Never commit Magento keys
- Use production mode in live environments
- Always secure file permissions
